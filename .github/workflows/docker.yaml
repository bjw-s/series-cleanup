---
name: docker
on:
  push:
    branches: [ master ]
  schedule:
    - cron:  '0 1 * * 0'
jobs:
  docker:
    if: "!contains(github.event.head_commit.message, '[ci-skip]')"
    runs-on: ubuntu-latest
    env:
        IMAGE_NAME: bjws/series-cleanup
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Login to Docker Registry
        env:
            DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
            DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
        run: echo "${DOCKERHUB_PASSWORD}" | docker login -u "${DOCKERHUB_USERNAME}" --password-stdin
      - name: Build container image
        run: |
          docker build \
            -t "${IMAGE_NAME}:latest" \
            -t "${IMAGE_NAME}:$(date '+%Y.%m.%d')" \
            -f build/package/Dockerfile .
      - name: Push container image
        run: |
          docker push "${IMAGE_NAME}:latest"
          docker push "${IMAGE_NAME}:$(date '+%Y.%m.%d')"
